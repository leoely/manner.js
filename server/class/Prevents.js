Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _http=_interopRequireDefault(require("http")),_net=_interopRequireDefault(require("net")),_advising=require("advising.js"),_parseHttpDate=_interopRequireDefault(require("../lib/parseHttpDate")),_Tackles=_interopRequireDefault(require("./Tackles"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class Prevents extends _Tackles.default{constructor(e,t){super(),this.dealParams(e,t),this.threshold=e,this.interval=t}dealParams(e,t){if(!(0<e))throw new Error("[Error] The parameter threshold should be of positive integer type.");if(!(0<t))throw new Error("[Error] The parameter interval should be of positive integer type.")}inspectStaticFile(e,t,r){if("string"!=typeof e)throw new Error("[Error] The parameter ip should be of string type.");if(t instanceof _http.default.ClientRequest)throw new Error("[Error] The parameter req should be the clientRequest type.");if(!(r instanceof _advising.Router))throw new Error("[Error] The parameter ipPevents should be the router type.");let i=!0;var s,o=r.gain(e);return void 0===o?(r.attach(e,1),s=this.interval,setTimeout(()=>{super.cleanTackle(e)},s)):(s=o,r.revise(e,s+=1),t=("string"==typeof(o=t.headers["if-modified-since"])&&"number"!=typeof(r=(0,_parseHttpDate.default)(o).getTime())&&r<=(new Date).getTime()&&(i=!1),this).threshold,t<=s&&(i=!1)),i}inspect(e,t){if("string"!=typeof e)throw new Error("[Error] The parameter ip should be of string type.");if(t instanceof _http.default.ClientRequest)throw new Error("[Error] The parameter req should be the clientRequest type.");var r,{}=this;if(_net.default.isIPv4(e))return r=this.ipv4Router,this.inspectStaticFile(e,t,r);if(_net.default.isIPv6(e))return r=this.ipv6Router,this.inspectStaticFile(e,t,r);throw new Error("[Error] The Ip type is not expected.")}}var _default=exports.default=Prevents;